# LINE 訂單管理系統使用說明

## 📋 系統概述

本系統提供 LINE 官方帳號訂單管理功能，採用「世界」概念進行多租戶管理。每個世界可以有多個使用者，支援建立訂單、修改訂單、查詢訂單、老闆查詢訂單明細（按廠商分組），並完整記錄所有操作歷史。

**多世界系統特色：**
- 支援加入多個世界（店家），可在不同世界間切換
- 每個世界都有唯一的世界 ID 和世界代碼（8 位亂碼）
- 自動管理當前世界，所有操作都在當前世界進行
- 店家可自訂訂單分類方式（透過顯示格式設定）

## 🎯 核心概念

### 世界（World）系統
- **世界**：一個獨立的訂單管理環境，類似於租戶或工作空間
- **Owner（擁有者）**：建立世界的使用者，擁有完整權限
- **消費者**：加入既有世界的使用者，可進行訂單操作
- **世界狀態**：控制世界的可用性和功能
- **世界 ID**：數字的唯一識別碼（如 `1`、`#000001`）
- **世界代碼**：8 位字母數字組合的亂碼識別碼（如 `ABC12345`），用於安全分享
- **當前世界**：使用者目前正在使用的世界，所有訂單操作都在當前世界進行

### 世界狀態流程
```
none → creating → vendorMap_setup → active
                  ↘ failed
```

**狀態說明：**
- `none`：世界不存在
- `creating`：邏輯過渡（建立新世界後現直接進入 `vendorMap_setup`）
- `vendorMap_setup`：等待 owner 設定訂單格式（只有 owner 可貼上格式）
- `active`：世界可正常使用，所有使用者可以使用訂單功能
- `failed`：初始化失敗（保留復原）

### 主世界畫面與加入/創造世界流程（Web）
```
主世界 [已加入世界₁ … 已加入世界ₙ | 加入/創造世界]
         │                              │
         └─ 選世界 → 訂單頁面            ├─ 加入既有世界 → 輸入 ID/代碼 → 綁定 → 訂單頁面
                                        └─ 創造新世界 → none → creating → vendorMap_setup → active
                                                                    ↘ failed
```

**說明：**
- **主世界**：登入 LINE 後 Web 第一頁，顯示標題「主世界」、已加入世界網格、以及「加入/創造世界」卡片（置於網格最後一格）
- **已加入世界**：點擊任一世界卡片 → 進入該世界訂單頁面
- **加入/創造世界**：點擊後可「加入既有世界」或「創造新世界」；創造新世界時進入上述世界狀態流程

## 🔧 環境設定

### 必要環境變數（.env 檔案）

```env
LINE_CHANNEL_SECRET=你的_LINE_Channel_Secret
LINE_CHANNEL_ACCESS_TOKEN=你的_LINE_Channel_Access_Token
PORT=3000
```

## 🚀 快速開始

### 1. 首次使用（加入系統）

當您首次加入 LINE Bot 時，系統會自動顯示：

```
歡迎使用訂單系統 👋

請選擇你要做的事：
1️⃣ 加入既有世界
2️⃣ 建立新世界（當老闆）

請直接回覆 1 或 2

輸入「重來」可重新選擇
```

**進入世界前的通用指令：**
- **重來**：回到主選單，系統回覆：
  ```
  好，我們重新來一次 🙂

  請選擇：
  1️⃣ 加入世界
  2️⃣ 建立新世界
  ```

#### 選項 1：加入既有世界
1. 輸入 `1` 或 `1️⃣` 或「加入既有世界」或「加入世界」
2. 系統會提示：`請輸入世界 ID`（例如：`1` 或 `#000001`），以及 `輸入「重來」可重新選擇`
3. 輸入世界 ID（數字格式如 `1` 或 `#1`）或世界代碼（8 位字母數字組合，如 `ABC12345`）
4. 系統驗證並加入世界，設定角色為「消費者」，並自動設定為當前世界

**錯誤處理：**
- 如果世界 ID 不存在，系統會顯示：
  ```
  ❌ 找不到這個世界
  請確認世界 ID 是否正確
  或請管理者重新提供

  請選擇：
  1️⃣ 重新輸入世界 ID
  2️⃣ 建立新世界

  輸入「重來」可重新選擇
  ```

#### 選項 2：建立新世界
1. 輸入 `2` 或 `2️⃣` 或「建立新世界」
2. 系統自動建立新世界，您成為 owner，狀態為 `vendorMap_setup`，並自動設定為當前世界
3. 系統回覆：
   ```
   ✅ 世界建立完成！
   世界代碼: ABC12345

   下一步：請設定第一個訂單格式（vendorMap）
   範例：
   飲料:
     - 珍珠奶茶
     - 紅茶
     - 綠茶
   請直接貼上你要的格式
   ```
   
   **注意：** 每個世界都會自動產生一個 8 位的世界代碼（如 `ABC12345`），可用於加入世界或分享給其他人。
4. 貼上你的訂單格式後，系統回覆：
   ```
   🎉 訂單格式設定完成！

   你現在可以：
   - 開始記訂單
   - 邀請使用者加入（請他們輸入世界 ID）

   輸入「幫助」查看可用指令
   ```

**VendorMap 設定格式**（可二擇一）：
- 廠商／類別 + 品項列表（`-` 開頭，無數量則預設 0）：
  ```
  飲料:
    - 珍珠奶茶
    - 紅茶
  便當
    品項1  10
    品項2  20
  ```

**飲料店屬性格式範例：**
```
飲料:
  - 珍珠奶茶 微冰 微糖
  - 珍珠奶茶 少冰 半糖
  - 珍珠奶茶 去冰 無糖
  - 紅茶 微冰 微糖
  - 紅茶 去冰 無糖
```

**說明：**
- 在 vendorMap 中，可以將帶屬性的品項列為不同的品項
- 實際下單時，使用者可以輸入完整的品項名稱（包含屬性）和數量
- 每個屬性組合會被視為獨立的品項進行統計

#### 階段：Active（啟用）
- 訂單格式設定成功後，世界狀態為 `active`
- 所有綁定該世界的使用者可以使用訂單功能
- 可以建立、修改、查詢訂單

## 📱 LINE 訊息格式

### 類型 A：建立訂單

系統無分店，每行「品項 數量」即可：

```
品項1 數量1
品項2 數量2
時間（可選，YYYY-MM-DD）
```

**範例：**
```
大杯紙杯 100
小杯紙杯 50
2024-01-15
```

或

```
紅茶茶包 200
綠茶茶包 150
```

**飲料店屬性格式範例：**
```
珍珠奶茶 微冰 微糖 5
珍珠奶茶 少冰 半糖 3
紅茶 去冰 無糖 2
```

**說明：**
- 品項名稱可以包含屬性（如冰塊、糖度等），屬性作為品項名稱的一部分
- 格式：`品項名稱 屬性1 屬性2 ... 數量`
- 每個屬性組合會被視為獨立的品項（例如「珍珠奶茶 微冰 微糖」和「珍珠奶茶 少冰 半糖」是不同的品項）
- 修改訂單時，需要輸入完整的品項名稱（包含屬性）

**注意：**
- 只有在世界狀態為 `active` 時才能建立訂單
- 透過 LINE 下單時，系統會自動記錄該使用者**當下的 LINE 顯示名稱**，用於老闆查詢時顯示「誰點的」

### 類型 B：修改訂單

```
修改
品項名稱
數字變化
```

**數字變化格式：**
- `+5`：增加 5 個
- `-3`：減少 3 個
- `=10`：設定為 10 個
- `5`：預設為增加 5 個（等同 +5）

**範例：**
```
修改
大杯紙杯
+10
```

```
改
紅茶茶包
-5
```

```
修改
小杯紙杯
=20
```

**飲料店屬性格式範例：**
```
修改
珍珠奶茶 微冰 微糖
+2
```

```
修改
紅茶 去冰 無糖
-1
```

**注意：**
- 如果修改後數量為 0，該品項會自動從訂單中刪除
- 修改時必須輸入**完整的品項名稱**（包含所有屬性），例如「珍珠奶茶 微冰 微糖」而不是「珍珠奶茶」
- 每個屬性組合是獨立的品項，修改時只會影響完全匹配的品項

### 類型 C：查詢訂單

```
查詢
今天 / 日期
```

**日期格式：**
- `今天` 或 `今日`：查詢今天的訂單
- `2024-01-15`：查詢指定日期的訂單（YYYY-MM-DD）

**範例：**
```
查詢
今天
```

```
查詢
2024-01-15
```

### 類型 D：老闆查詢訂單明細

```
老闆查詢
今天 / 日期
```

或

```
老闆查
今天 / 日期
```

**功能說明：**
- 查詢指定日期、**當前世界**的所有訂單
- 依照世界設定的 vendorMap 自動分組顯示
- 顯示格式：廠商 → 品項數量（無分店時為廠商 → 品項）
- 相同品項會自動累加數量
- **僅在老闆查詢**：每個品項的數量後會顯示該品項是**誰點的**，格式為 `品項 數量 (點單者A、點單者B)`

**日期格式：**
- `今天` 或 `今日`：查詢今天的訂單
- `2024-01-15`：查詢指定日期的訂單（YYYY-MM-DD）

**範例：**
```
老闆查詢
今天
```

```
老闆查詢
2024-01-15
```

**輸出格式範例：**
```
廠商A
    大杯紙杯 15 (小明、小華)
    小杯紙杯 10 (小明)
廠商B
    紅茶茶包 20 (阿中)
```

**飲料店屬性格式輸出範例：**
```
飲料店
    珍珠奶茶 微冰 微糖 5 (小明、小華)
    珍珠奶茶 少冰 半糖 3 (小明)
    紅茶 去冰 無糖 2 (小華)
```

**說明：**
- 每個屬性組合（如「珍珠奶茶 微冰 微糖」）會被視為獨立的品項
- 相同屬性組合的數量會自動累加
- 不同屬性組合不會合併（例如「珍珠奶茶 微冰 微糖」和「珍珠奶茶 少冰 半糖」是分開統計的）

（透過 LINE 下單時會記錄顯示名稱；API 建立或無法取得時，若無名稱則不顯示括號。）

### 清理所有訂單

傳送以下任一指令即可清理所有訂單：
- `清理訂單`
- `清除訂單`
- `清空訂單`
- `刪除訂單`
- `清理`
- `清除`
- `清空`

**注意：** 只有在世界狀態為 `active` 時才能清理訂單，且**僅世界擁有者（老闆）**可以執行。

### 世界管理指令

#### 查看所有世界
輸入 `我的店家` 或 `所有店家` 或 `查看店家` 可查看所有已加入的世界列表，包含：
- 世界名稱或 ID
- 世界代碼（8 位字母數字組合）
- 角色（老闆/消費者）
- 狀態（啟用中/設定中/未啟用）
- 目前使用的世界標記

#### 查看當前世界
輸入 `當前店家` 或 `目前店家` 可查看目前正在使用的世界資訊，包含：
- 世界名稱或 ID
- 世界代碼
- 角色
- 狀態
- 可用功能提示

#### 切換世界
輸入 `切換世界` 或 `切換店家` 可切換到其他已加入的世界。

**使用方式：**
1. 輸入 `切換世界` 查看可用世界列表
2. 輸入世界 ID（如 `1` 或 `#000001`）或世界代碼（如 `ABC12345`）
3. 或直接輸入 `切換世界 1` 或 `切換世界 ABC12345`

**注意：**
- 只有已加入的世界才能切換
- 切換後，所有訂單操作都會在該世界進行
- 如果切換到未完成設定的世界，會提示等待設定完成

#### 刪除/退出世界
- **消費者**：輸入 `退出世界` 或 `離開世界` 可離開某個已加入的世界（僅解除綁定，世界仍存在）。
- **老闆（擁有者）**：輸入 `刪除世界` 或 `退出世界` 可**刪除**世界；刪除後該世界所有內容（訂單、歷史、菜單、成員等）將**永久刪除，無法復原**，系統會要求**二次確認**（輸入「確認刪除世界 [ID或代碼]」才執行）。

**消費者退出世界：**
1. 輸入 `退出世界` 查看可用世界列表
2. 輸入世界 ID 或世界代碼（或直接輸入 `退出世界 1`、`退出世界 ABC12345`）

**老闆刪除世界：**
1. 輸入 `刪除世界` 查看世界列表（會提示刪除後無法復原）
2. 輸入要刪除的世界 ID 或代碼 → 系統再次提醒並要求確認
3. 輸入 `確認刪除世界 [ID]` 或 `確認刪除世界 [代碼]` 執行刪除

**注意：**
- 消費者退出後將無法再使用該世界的訂單功能；若退出的是當前世界，系統會清除當前世界設定
- 老闆刪除後該世界不存在，所有成員皆無法再進入
- 若這是您唯一的世界，退出/刪除後需重新加入或建立世界

### 幫助（進入世界後）

輸入 `幫助` 可查看你目前能使用的指令；系統會依 **owner** 或 **user** 顯示不同內容。

**Owner（老闆）可使用的指令：**
- 記訂單
- 查訂單
- 修改訂單
- 老闆查詢歷史訂單
- 老闆清除訂單
- 我的店家（查看所有世界）
- 當前店家（查看當前世界）
- 切換世界
- 刪除世界（需二次確認，刪除後該世界所有內容永久刪除）

**User（消費者）可使用的指令：**
- 記訂單
- 查訂單
- 修改訂單
- 我的店家（查看所有世界）
- 當前店家（查看當前世界）
- 切換世界
- 退出世界

## 🌐 API 端點

### LINE Webhook
- **POST** `/webhook/line` - 接收 LINE 訊息

### 訂單管理 API

**注意：** 所有訂單相關 API 都需要世界狀態為 `active`，否則會返回 403 錯誤。

#### 建立訂單
- **POST** `/api/orders`
```json
{
  "branch": "台北店",
  "items": [
    { "name": "大杯紙杯", "qty": 100 },
    { "name": "小杯紙杯", "qty": 50 }
  ],
  "userId": "LINE_USER_ID",  // 必填
  "user": "admin"            // 可選，下單者名稱（透過 LINE 下單時會自動帶入當下顯示名稱，供老闆查詢顯示）
}
```

#### 修改訂單數量
- **PUT** `/api/orders/items/:itemId`
```json
{
  "qty": 150,
  "user": "admin" // 可選
}
```

#### 新增品項到訂單
- **POST** `/api/orders/:orderId/items`
```json
{
  "name": "大杯紙杯",
  "qty": 50,
  "user": "admin" // 可選
}
```

#### 刪除訂單品項
- **DELETE** `/api/orders/items/:itemId`
```json
{
  "user": "admin" // 可選
}
```

#### 取消訂單
- **POST** `/api/orders/:orderId/cancel`
```json
{
  "user": "admin" // 可選
}
```

#### 恢復訂單（使用者補救）
- **POST** `/api/orders/:orderId/restore`
```json
{
  "user": "admin" // 可選
}
```

#### 查詢訂單詳情
- **GET** `/api/orders/:orderId`

#### 查詢訂單歷史記錄（只有 owner 可以使用）
- **GET** `/api/order-history?orderId=1234567890&userId=xxx`
  - 必須提供 `userId` 參數
  - 只有世界 owner 可以查詢歷史記錄
  - 不提供 `orderId` 參數則查詢所有歷史記錄

#### 老闆查詢訂單明細（按廠商分組）
- **GET** `/api/boss-query?date=2024-01-15&userId=xxx`
  - 查詢指定日期的所有訂單，依照廠商分組顯示
  - 參數：
    - `date`：日期（`今天`、`今日` 或 `YYYY-MM-DD` 格式）
    - `userId`：必填，用於權限與世界綁定
  - 回應包含：
    - `formatted`：格式化的文字輸出
    - `data`：結構化的 JSON 資料（廠商 → 品項）

**範例回應：**
```json
{
  "date": "2024-01-15",
  "totalOrders": 2,
  "formatted": "廠商A\n    大杯紙杯 15 (小明、小華)\n    小杯紙杯 10 (小明)\n廠商B\n    大杯紙杯 8 (小華)",
  "data": {
    "廠商A": { "大杯紙杯": 15, "小杯紙杯": 10 },
    "廠商B": { "大杯紙杯": 8 }
  }
}
```
`formatted` 為老闆查詢的文字輸出（品項後附點單者）；`data` 為僅數量的結構化 JSON。

### 其他 API

#### 查詢所有訂單（JSON）
- **GET** `/orders/json`

#### 清理所有訂單
- **DELETE** `/orders?userId=xxx`
  - 必須提供 `userId` 查詢參數
  - **僅世界擁有者（老闆）**可執行，否則回傳 403

## 📊 資料庫結構

### orders 表（目前訂單狀況）
- `id` - 主鍵
- `order_id` - 訂單 ID（用於分組）
- `branch` - 廠商／類別（無分類時可為空字串）
- `item` - 品項名稱
- `qty` - 數量
- `status` - 狀態（預設 'pending'）
- `created_at` - 建立時間

**注意：** `orders` 表只存目前有效的訂單，取消或刪除的訂單會從此表移除。

### order_history 表（歷史記錄）
- `id` - 主鍵
- `order_id` - 訂單 ID
- `action_type` - 操作類型（建立訂單、修改數量、新增品項、刪除品項、訂單取消、使用者補救）
- `old_data` - 變更前的資料（JSON）
- `new_data` - 變更後的資料（JSON）
- `user` - 操作者；**建立訂單**時為下單者當下的 **LINE 顯示名稱**（透過 LINE 下單時自動取得，API 可選填，用於老闆查詢顯示「誰點的」）
- `created_at` - 操作時間

**注意：** 所有操作歷史都會保存在 `order_history` 表中，即使訂單已從 `orders` 表刪除。

### worlds 表（世界資訊）
- `id` - 主鍵（世界 ID）
- `status` - 世界狀態（none, creating, vendorMap_setup, active, failed）
- `ownerUserId` - 世界擁有者使用者 ID
- `vendorMap` - 訂單規格設定（JSON 格式）
- `created_at` - 建立時間
- `updated_at` - 更新時間

### user_world_bindings 表（使用者世界綁定）
- `id` - 主鍵
- `userId` - 使用者 ID
- `worldId` - 世界 ID
- `role` - 角色（owner 或 employee）
- `created_at` - 綁定時間

**注意：** 每個使用者對每個世界只能有一筆綁定記錄（UNIQUE 約束）。

## 🔄 操作流程

### 世界建立流程
1. **使用者加入系統**：首次加入時選擇「建立新世界」
2. **世界建立**：系統建立世界，狀態為 `vendorMap_setup`，使用者成為 owner
3. **訂單格式設定**：Owner 依提示貼上 vendorMap（訂單規格）
4. **啟用世界**：設定成功後，狀態轉換到 `active`，所有使用者可以使用訂單功能

### 訂單操作流程
1. **建立訂單**：透過 LINE 訊息或 API 建立訂單，系統會自動記錄到 `orders` 表和 `order_history` 表
2. **修改訂單**：修改數量、新增品項、刪除品項，所有操作都會記錄歷史
3. **取消訂單**：訂單會從 `orders` 表移除，但歷史記錄保留在 `order_history` 表
4. **恢復訂單**：從 `order_history` 表中恢復已取消的訂單到 `orders` 表
5. **查詢訂單**：可查詢目前訂單或歷史記錄（歷史記錄只有 owner 可以查詢）

## 🔐 權限管理

### Owner（擁有者）權限
- ✅ 建立世界
- ✅ 在 `vendorMap_setup` 階段設定訂單格式
- ✅ 查詢訂單歷史記錄（老闆查詢）
- ✅ 清理所有訂單（老闆清除訂單）
- ✅ 所有訂單操作（記訂單、修改、查詢）
- ✅ 輸入「幫助」可看到老闆專用指令

### 消費者權限
- ✅ 加入既有世界
- ✅ 記訂單、查訂單、修改訂單
- ✅ 輸入「幫助」可看到一般指令
- ❌ 查詢訂單歷史記錄（僅 owner）
- ❌ 清理所有訂單（僅 owner）
- ❌ 世界設定相關操作

## 🚀 啟動伺服器

```bash
node src/index.js
```

伺服器預設運行在 `http://localhost:3000`

## ⚠️ 注意事項

1. 確保 `.env` 檔案已正確設定 LINE Channel Secret 和 Access Token
2. 資料庫檔案 `orders.db` 會自動建立
3. 所有操作都會記錄歷史，無法刪除歷史記錄
4. 修改品項時，如果數量變為 0，該品項會自動刪除
5. 查詢功能會從歷史記錄中查詢，支援日期過濾，並依當前世界篩選
6. **訂單功能僅在世界狀態為 `active` 時可用**
7. **歷史記錄查詢、清理所有訂單僅限世界 owner**
8. 世界 ID 驗證失敗時，系統會提供引導選項；輸入「重來」可回到主選單
9. 請在**專案根目錄**執行 `node src/index.js`，以確保 `orders.db` 建立於正確路徑

## 📝 範例對話

### 首次加入與重來
```
系統：歡迎使用訂單系統 👋
      請選擇你要做的事：
      1️⃣ 加入既有世界
      2️⃣ 建立新世界（當老闆）
      請直接回覆 1 或 2
      輸入「重來」可重新選擇

使用者：重來

系統：好，我們重新來一次 🙂
      請選擇：
      1️⃣ 加入世界
      2️⃣ 建立新世界
```

### 加入既有世界
```
使用者：1

系統：請輸入世界 ID
      （例如：1 或 #000001）
      輸入「重來」可重新選擇

使用者：1

系統：成功加入世界 #1
```

### 建立新世界與訂單格式
```
使用者：2

系統：✅ 世界建立完成！
      下一步：請設定第一個訂單格式（vendorMap）
      （格式見上方「VendorMap 設定格式」）
      請直接貼上你要的格式

使用者：（貼上格式）

系統：🎉 訂單格式設定完成！
      你現在可以：記訂單、邀請使用者加入（請他們輸入世界 ID）
      輸入「幫助」查看可用指令
```

### 建立訂單
```
使用者：大杯紙杯 100
       小杯紙杯 50

系統：✅ 訂單已建立
      訂單 ID: 1705123456789
      大杯紙杯 x100
      小杯紙杯 x50
```

### 修改訂單
```
使用者：修改
       大杯紙杯
       +10

系統：✅ 已修改 1 筆訂單
      品項: 大杯紙杯
      訂單 1705123456789: 100 → 110 (+10)
```

### 查詢訂單
```
使用者：查詢
       今天

系統：📋 查詢結果 (共 1 筆)
      日期: 今天

      訂單 1 (ID: 1705123456789)
       大杯紙杯 x110
       小杯紙杯 x50
      建立時間: 2024-01-15 10:30:00
```

### 老闆查詢訂單明細
```
使用者：老闆查詢
       2024-01-15

系統：📋 老闆查詢結果
      日期: 2024-01-15

      廠商A
          大杯紙杯 15 (小明、小華)
          小杯紙杯 10 (小明)
      廠商B
          紅茶茶包 20 (阿中)
```

### 世界狀態錯誤
```
使用者：大杯紙杯 100

系統：❌ 世界尚未啟用，無法使用訂單功能
```

## 🎯 目前階段功能總覽

### ✅ 已實作功能

1. **世界管理系統**
   - 建立新世界（使用者成為 owner）
   - 加入既有世界（使用者成為消費者）
   - 世界狀態管理（none → creating → vendorMap_setup → active / failed）
   - 世界 ID 驗證與錯誤處理

2. **使用者綁定系統**
   - 使用者與世界的綁定關係
   - 角色管理（老闆 / 消費者）
   - 首次加入時的歡迎訊息與引導
   - 進入世界前通用指令「重來」

3. **權限控制**
   - Owner 專屬功能（世界設定、歷史記錄查詢、清理所有訂單）
   - 消費者基本功能（記訂單、查訂單、修改訂單）
   - 世界狀態檢查（只有 active 狀態才能使用訂單功能）
   - 進入世界後通用指令「幫助」（依 owner／user 顯示不同指令）

4. **訂單格式設定（VendorMap）**
   - Owner 在 vendorMap_setup 階段設定訂單規格
   - 格式驗證與錯誤處理
   - 設定成功/失敗的狀態轉換

5. **訂單管理功能**
   - 建立訂單（LINE 訊息 / API）；透過 LINE 下單時會記錄當下顯示名稱
   - 修改訂單數量（增加、減少、設定）
   - 新增/刪除訂單品項
   - 查詢訂單（按日期，依當前世界）
   - 老闆查詢（按廠商分組，品項後顯示點單者 LINE 名稱）
   - 取消訂單
   - 恢復訂單（使用者補救）
   - 清理所有訂單（僅 owner）

6. **歷史記錄系統**
   - 完整記錄所有訂單操作
   - Owner 專屬的歷史記錄查詢
   - 訂單恢復功能

7. **API 端點**
   - RESTful API 支援所有訂單操作
   - 世界狀態檢查
   - 權限驗證

8. **錯誤處理與使用者引導**
   - 世界 ID 驗證失敗的引導訊息（含「重來」選項）
   - 世界狀態錯誤提示
   - 權限不足的錯誤訊息（如：僅 owner 可清理訂單）

### 🔄 功能流程

**世界建立流程：**
1. 使用者選擇「建立新世界」→ 世界建立（vendorMap_setup）
2. Owner 貼上訂單格式 → 轉換到 active
3. 所有使用者可以使用訂單功能

**使用者加入流程：**
1. 使用者加入系統 → 檢查是否已綁定世界
2. 未綁定 → 顯示歡迎訊息與選項
3. 選擇加入 → 輸入世界 ID → 驗證 → 加入成功
4. 選擇建立 → 建立新世界 → 成為 owner

**訂單操作流程：**
1. 檢查世界狀態（必須為 active）
2. 執行訂單操作（建立、修改、查詢等）
3. 記錄操作歷史
4. 返回結果給使用者

## 📞 技術支援

如有問題或建議，請聯繫系統管理員。
