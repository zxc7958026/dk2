# LINE 訂單管理系統 — 推薦報告

> 一套整合 LINE、Web 與 Excel 的多租戶訂單系統，適合飲料店、團購、代購、多廠商等場景，免安裝、易上手、可自訂格式與報表。

---

## 一、推薦摘要

本系統已完成開發，可立即用於**多店家／多世界**的訂單收集與管理。使用者透過 **LINE** 或 **Web 網頁**下單，老闆可查詢彙總、匯出 **Excel**，並完整保留**操作歷史**。採用「世界」概念做多租戶隔離，同一套系統可同時服務多個獨立店家，各自擁有自己的菜單與訂單。

**一句話推薦：** 用 LINE 登入即可用的輕量訂單系統，支援多世界、自訂品項格式、老闆彙總查詢與 Excel 匯出，適合小團隊與實體店家。

---

## 二、核心亮點

| 亮點 | 說明 |
|------|------|
| **多世界（多租戶）** | 一個帳號可加入多個「世界」（店家），切換即可管理不同店家的訂單，世界代碼可安全分享給消費者加入。 |
| **雙通道下單** | 支援 **LINE 訊息** 與 **Web 網頁** 兩種下單方式，消費者可用最習慣的方式操作。 |
| **自訂訂單格式** | 老闆可自訂廠商／類別、品項與屬性（如甜度、冰塊、尺寸），系統依格式解析並彙總。 |
| **老闆專用彙總** | 老闆查詢可依日期取得「按廠商→類別→品項」分組的明細，並顯示**誰點的**（點單者）。 |
| **完整操作歷史** | 建立、修改、新增品項、刪除品項、取消、恢復等操作皆寫入歷史，可追溯與補救。 |
| **Excel 雙向支援** | 菜單可從 **Excel 匯入**（含下拉選項）；訂單可**匯出 Excel**，欄位與順序可自訂。 |
| **權限分明** | Owner（老闆）可清理訂單、查歷史、設定格式；消費者僅能下單與查自己的訂單。 |

---

## 三、功能總覽

### 3.1 入口與多世界

- **LINE 登入**：Web 端以 LINE 登入，無需另建帳密。
- **主世界頁**：顯示已加入的世界卡片，可點選進入該世界訂單頁，或透過「加入/創造世界」加入新店家或建立新世界。
- **加入世界**：輸入世界 ID 或 8 位世界代碼即可綁定為消費者。
- **創造世界**：建立新世界後設定訂單格式（VendorMap），設定完成即啟用（active），可開始接單。

### 3.2 下單方式

**LINE**

- 建立訂單：以「品項 數量」每行一筆傳送訊息即可建立訂單（無分店時）。
- 修改訂單：支援「修改 + 品項 + 數量變化」（+n / -n / =n）。
- 查詢訂單：可依「今天」或指定日期查詢。
- 飲料店等可支援「品項 屬性1 屬性2 數量」（如甜度、冰塊），每種屬性組合獨立統計。

**Web**

- 選擇世界後進入訂單頁，以點選品項、設定數量、填寫訂購人、確認後送出。
- 支援品項圖片（老闆上傳）、下拉選單（甜度、冰塊等，由 Excel 或格式設定帶入）。

### 3.3 老闆專用功能

- **老闆查詢**：依日期查詢當日（或指定日）所有訂單，依廠商→類別→品項分組，品項後顯示點單者，例如：`珍珠奶茶 微冰 微糖 5 (小明、小華)`。
- **訂單歷史**：僅 Owner 可查詢訂單歷史記錄（含取消、恢復），便於稽核與補救。
- **清理訂單**：僅 Owner 可執行清理所有訂單（如日結後清空）。
- **菜單管理**：上傳 Excel 菜單、設定欄位對應、管理品項圖片。
- **匯出 Excel**：自訂匯出欄位與順序，匯出為 Excel 供報表或進銷存使用。

### 3.4 菜單與格式

- **VendorMap 文字格式**：老闆可貼上「廠商/類別 + 品項列表（含屬性）」設定訂單規格。
- **Excel 菜單**：最少三欄「廠商、品項、數量」；可選「下拉選項」欄位定義甜度、冰塊等，格式為 `屬性名,選項1,選項2;下一屬性,...`。
- 支援多店家、多品項、多屬性（團購、代購、飲料店、便當、服飾等），數量一律在最後，系統依此解析與彙總。

### 3.5 API 與整合

- **Webhook**：`POST /webhook/line` 接收 LINE 訊息。
- **訂單 CRUD**：建立、修改數量、新增/刪除品項、取消、恢復訂單等 REST API。
- **老闆查詢 API**：`GET /api/boss-query?date=...&userId=...` 取得依廠商分組的彙總（含 formatted 文字與 data JSON）。
- **訂單歷史 API**：僅 Owner 可呼叫，依 `orderId` / `userId` 查詢歷史。

---

## 四、適用場景

- **飲料店／手搖店**：廠商/類別 + 品項 + 甜度/冰塊，消費者 LINE 或 Web 下單，老闆彙總查詢與 Excel 匯出。
- **團購／代購**：多廠商（全聯、家樂福、藥局等），品項可帶規格與數量，老闆依廠商分組查詢。
- **多世界／多品牌**：一帳號多世界，每個世界獨立菜單與訂單，適合同時經營多個店或品牌。
- **便當、餐廳外送**：廠商/類別 + 品項（可含加料選項），彙總後方便備料與出單。
- **服飾／電商代購**：品項含尺寸、顏色、型號等屬性，系統依完整品項名稱統計。

---

## 五、技術與部署要點

- **技術棧**：Node.js、Express、SQLite、LINE Messaging API；前端靜態頁 + 後端 API。
- **環境變數**：`LINE_CHANNEL_SECRET`、`LINE_CHANNEL_ACCESS_TOKEN`、`PORT`（如 3000）。
- **資料庫**：`orders.db` 自動建立，內含訂單、訂單歷史、世界、使用者世界綁定等表。
- **啟動**：於專案根目錄執行 `node src/index.js`，確保 DB 路徑正確。
- **依賴**：dotenv、exceljs、express、multer、sqlite3、xlsx 等（見 `package.json`）。

---

## 六、總結與建議

本系統已具備**多世界、LINE + Web 雙通道、自訂格式、老闆彙總與點單者顯示、完整歷史、Excel 匯入/匯出與 API**，適合推薦給：

- 需要輕量、免安裝、以 LINE 為主要入口的店家或內部訂單管理。
- 希望一組人同時管理多個店家／品牌，且各自獨立菜單與訂單的團隊。
- 需要依廠商/類別彙總、看到「誰點的」並匯出 Excel 做報表的老闆。

**建議後續可視需求擴充：** 通知提醒（如新訂單推播）、更多報表篩選、權限細分（如店長/消費者）等；目前架構與 API 已可支援這類延伸。

---

*報告依據專案「使用說明」「操作流程指南」「範例展示」及程式結構整理，可直接複製至 Notion 使用。*
